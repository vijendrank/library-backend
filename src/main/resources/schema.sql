
CREATE TABLE USER (
    ID      BIGINT GENERATED BY DEFAULT AS IDENTITY,
    NAME    VARCHAR(50)  NOT NULL,
    EMAIL   VARCHAR(80)  NOT NULL,
    ROLE    VARCHAR(250) NOT NULL
);

CREATE UNIQUE INDEX UK_USER_EMAIL ON USER (EMAIL);

CREATE TABLE BOOK (
    ID      BIGINT GENERATED BY DEFAULT AS IDENTITY,
    NAME    VARCHAR(80)  NOT NULL,
    AUTHOR  VARCHAR(250) NOT NULL,
    ISBN    VARCHAR(30)  NOT NULL
    
);

CREATE UNIQUE INDEX UK_ISBN ON BOOK (ISBN);

CREATE TABLE RESERVATION (
    ID             BIGINT GENERATED BY DEFAULT AS IDENTITY,
    BOOK_ID        BIGINT NOT NULL,
    USER_ID        BIGINT NOT NULL,
    RESERVE_DATE   DATE   NOT NULL DEFAULT CURRENT_DATE,
    RETURN_DATE    DATE   NOT NULL DEFAULT CURRENT_DATE + 14,
    RESERVE_COUNT  INT    NOT NULL DEFAULT 1
);

CREATE UNIQUE INDEX UK_RESEVATION ON RESERVATION (BOOK_ID, USER_ID);
ALTER TABLE RESERVATION ADD FOREIGN KEY(BOOK_ID) REFERENCES BOOK(ID);
ALTER TABLE RESERVATION ADD FOREIGN KEY(USER_ID) REFERENCES USER(ID);


CREATE TABLE RETURN_HISTORY (
     ID            BIGINT GENERATED BY DEFAULT AS IDENTITY,
     BOOK_ID       BIGINT NOT NULL,
     USER_ID       BIGINT NOT NULL,
     RETURN_DATE   DATE   NOT NULL
);

ALTER TABLE RESERVATION ADD FOREIGN KEY(BOOK_ID) REFERENCES BOOK(ID);
ALTER TABLE RESERVATION ADD FOREIGN KEY(USER_ID) REFERENCES USER(ID);
